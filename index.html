<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>顧客滿意度問卷</title>
  <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
  <style>
    /* --- 全域樣式 --- */
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --accent:#0057b8;
      --muted:#667085;
      --success:#0f9d58;
      --radius:14px;
      --glass: rgba(255,255,255,0.75);
      font-family: "Noto Sans TC", "Microsoft JhengHei", -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }

    html,body{
      height:100%;
      margin:0;
      background: linear-gradient(180deg, #eef2ff 0%, var(--bg) 100%);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
      box-sizing:border-box;
    }

    .card{
      width:100%;
      max-width:560px;
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:0 10px 30px rgba(16,24,40,0.08);
      padding:28px;
      box-sizing:border-box;
      backdrop-filter: blur(6px);
      border: 1px solid rgba(16,24,40,0.04);
    }

    h1{font-size:20px;margin:0 0 8px;color:#0f172a}
    p.lead{margin:0 0 18px;color:var(--muted);font-size:14px}

    form{display:flex;flex-direction:column;gap:18px}

    .field{
      display:flex;flex-direction:column;gap:8px;
    }

    label.question{
      font-weight:600;color:#0f172a;font-size:14px;
    }

    /* 選項容器 */
    .options{display:flex;gap:10px;flex-wrap:wrap}

    .option{
      display:inline-flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;border:1px solid rgba(16,24,40,0.06);background:var(--glass);cursor:pointer;user-select:none;transition:all .18s ease;
    }

    .option input{appearance:none;display:inline-block;width:18px;height:18px;border-radius:6px;border:2px solid rgba(16,24,40,0.12);background:transparent}
    .option input:checked{background:var(--accent);border-color:var(--accent);box-shadow:0 0 0 4px rgba(0,87,184,0.08)}

    .note{font-size:12px;color:var(--muted)}

    .btn{
      display:inline-flex;align-items:center;justify-content:center;padding:12px 16px;border-radius:10px;border:0;background:var(--accent);color:#fff;font-weight:700;cursor:pointer;font-size:14px;transition:transform .12s ease;
    }
    .btn:active{transform:translateY(1px)}
    .btn[disabled]{opacity:.6;cursor:default}

    .status{display:flex;align-items:center;gap:10px;color:var(--muted)}

    /* 已填寫區塊 */
    .done{display:none;text-align:center;padding:18px;border-radius:12px;background:linear-gradient(180deg,rgba(15,157,88,0.06),transparent);border:1px solid rgba(15,157,88,0.12)}
    .done h3{color:var(--success);margin:0}

    /* 響應 */
    @media (max-width:480px){
      .card{padding:18px;border-radius:12px}
      .option{padding:10px}
    }
  </style>
</head>

<body>

<div class="wrap">
  <div class="card" role="region" aria-labelledby="title">
    <h1 id="title">顧客滿意度問卷</h1>
    <p class="lead">請花 1 分鐘回答幾個問題，您的回饋對我們很重要。</p>

    <div id="status" class="status">正在載入...</div>

    <!-- 問卷區 -->
    <div id="surveyArea" style="display:none;">
      <form id="surveyForm">
        <input type="hidden" name="UID" id="UID">

        <div class="field">
          <label class="question">Q1：您對本次服務的整體滿意度？ <span class="note">(必填)</span></label>
          <div class="options" role="radiogroup" aria-labelledby="q1">
            <label class="option"><input type="radio" name="Q1" value="非常滿意" required> 非常滿意</label>
            <label class="option"><input type="radio" name="Q1" value="滿意"> 滿意</label>
            <label class="option"><input type="radio" name="Q1" value="普通"> 普通</label>
            <label class="option"><input type="radio" name="Q1" value="不滿意"> 不滿意</label>
          </div>
        </div>

        <div class="field">
          <label class="question">Q2：您會再度光臨本店嗎？ <span class="note">(必填)</span></label>
          <div class="options" role="radiogroup">
            <label class="option"><input type="radio" name="Q2" value="會" required> 會</label>
            <label class="option"><input type="radio" name="Q2" value="不太可能"> 不太可能</label>
            <label class="option"><input type="radio" name="Q2" value="不會"> 不會</label>
          </div>
        </div>

        <div class="field">
          <label class="question">若有任何建議（選填）</label>
          <textarea name="comment" rows="4" placeholder="例如：服務哪裡可以改進、想要的商品或活動..." style="resize:vertical;padding:10px;border-radius:8px;border:1px solid rgba(16,24,40,0.06);font-size:14px;"></textarea>
        </div>

        <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;">
          <div class="note">您的回覆將保密，僅作為內部改進使用。</div>
          <button class="btn" id="submitBtn" type="submit">送出問卷</button>
        </div>
      </form>
    </div>

    <!-- 已填寫顯示 -->
    <div id="doneArea" class="done" style="display:none;">
      <h3>您已經填寫過本次問卷，感謝您的參與！</h3>
      <p class="note">若需要修改回覆，請聯絡我們的門市人員或客服。</p>
    </div>

  </div>
</div>

<script>
  // ★ 請保留或替換為您自己的 GAS 部署網址
  const GAS_URL = "https://script.google.com/macros/s/AKfycbzCphcqbEMUOcioq-owF9Q5jbtHvYRCAvxOm3Qb3lZLJd8ULYcrrFWhwA_CmIibtHKm/exec";

  document.addEventListener("DOMContentLoaded", async () => {
    try{
      await liff.init({ liffId: "2001230327-l7YbvL9o" });
      const profile = await liff.getProfile();
      const uid = profile.userId;
      document.getElementById('UID').value = uid;

      // 檢查是否已填寫
      const statusEl = document.getElementById('status');
      statusEl.textContent = '正在檢查是否已填寫...';

      const res = await fetch(`${GAS_URL}?uid=${encodeURIComponent(uid)}&check=1`);
      const data = await res.json();

      statusEl.style.display = 'none';

      if (data && data.filled) {
        document.getElementById('doneArea').style.display = 'block';
      } else {
        document.getElementById('surveyArea').style.display = 'block';
      }

    }catch(err){
      console.error(err);
      document.getElementById('status').textContent = '載入失敗，請確認網路或 LIFF 設定。';
    }
  });

  // 表單送出
  document.getElementById('surveyForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled = true;
    submitBtn.textContent = '送出中...';

    const form = e.target;
    const formData = new FormData(form);

    try{
      const res = await fetch(GAS_URL, { method: 'POST', body: formData });
      const result = await res.json();

      if (result && result.status === 'success'){
        document.getElementById('surveyArea').style.display = 'none';
        const done = document.getElementById('doneArea');
        done.style.display = 'block';
        done.querySelector('h3').textContent = '問卷已送出，感謝您的寶貴意見！';
      }else{
        alert('送出失敗，請稍後再試。');
        submitBtn.disabled = false;
        submitBtn.textContent = '送出問卷';
      }

    }catch(err){
      console.error(err);
      alert('無法送出（網路或服務端錯誤）。');
      submitBtn.disabled = false;
      submitBtn.textContent = '送出問卷';
    }
  });
</script>

</body>
</html>
