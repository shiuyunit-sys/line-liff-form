<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
  <title>顧客滿意度問卷</title>
  <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
</head>

<body style="text-align:center; padding-top:50px; font-family:sans-serif;">

<div id="status">正在載入...</div>

<!-- 尚未填寫時顯示 -->
<div id="surveyArea" style="display:none;">
  <form id="surveyForm">
    <input type="hidden" name="UID" id="UID">

    <label>Q1：對服務滿意嗎？</label>
    <select name="Q1">
      <option value="好">好</option>
      <option value="普通">普通</option>
      <option value="差">差</option>
    </select>

    <label>Q2：會再訪嗎？</label>
    <select name="Q2">
      <option value="會">會</option>
      <option value="不會">不會</option>
    </select>

    <button type="submit">送出</button>
  </form>
</div>

<!-- 已填寫顯示 -->
<div id="doneArea" style="display:none;">
  <h3 style="color:#555;">您已經填寫過本次問卷，感謝您的參與！</h3>
</div>
// ★ 你的 GAS 部署網址
const GAS_URL = "https://script.google.com/macros/s/AKfycbzCphcqbEMUOcioq-owF9Q5jbtHvYRCAvxOm3Qb3lZLJd8ULYcrrFWhwA_CmIibtHKm/exec";


document.addEventListener("DOMContentLoaded", async () => {
  await liff.init({ liffId: "2001230327-l7YbvL9o" });

  const profile = await liff.getProfile();
  const uid = profile.userId;

  // 將 UID 放進隱藏欄位
  document.getElementById("UID").value = uid;

  // ★ 檢查是否已填寫
  const res = await fetch(`${GAS_URL}?uid=${uid}&check=1`);
  const data = await res.json();

  document.getElementById("status").style.display = "none";

  if (data.filled) {
    document.getElementById("doneArea").style.display = "block";
  } else {
    document.getElementById("surveyArea").style.display = "block";
  }
});


// ★ 表單送出（POST）
document.getElementById("surveyForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const formData = new FormData(e.target);

  const res = await fetch(GAS_URL, {
    method: "POST",
    body: formData
  });

  const result = await res.json();

  if (result.status === "success") {
    document.getElementById("surveyArea").style.display = "none";
    document.getElementById("doneArea").innerHTML =
      "<h3>問卷已送出，感謝您的填寫！</h3>";
    document.getElementById("doneArea").style.display = "block";
  }
});

</script>

</body>
</html>
