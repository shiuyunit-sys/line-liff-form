<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>顧客滿意度問卷</title>

  <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>

  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --accent:#0057b8;
      --muted:#667085;
      --success:#0f9d58;
      --radius:14px;
      font-family:"Noto Sans TC","Microsoft JhengHei",system-ui;
    }

    html,body{
      margin:0;
      background:linear-gradient(180deg,#eef2ff 0%,var(--bg) 100%);
    }

    .wrap{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }

    .card{
      width:100%;
      max-width:560px;
      background:#fff;
      border-radius:14px;
      box-shadow:0 10px 30px rgba(16,24,40,.08);
      padding:24px;
    }

    h1{margin:0 0 6px;font-size:20px}
    p.lead{margin:0 0 18px;color:var(--muted);font-size:14px}

    form{display:flex;flex-direction:column;gap:18px}

    .field{display:flex;flex-direction:column;gap:8px}
    label.question{font-weight:600;font-size:14px}

    .options{display:flex;gap:10px;flex-wrap:wrap}

    textarea,select,input[type="date"]{
      padding:10px;
      border-radius:8px;
      border:1px solid rgba(0,0,0,.15);
      font-size:14px;
    }

    .btn{
      padding:12px;
      border-radius:10px;
      border:none;
      background:var(--accent);
      color:#fff;
      font-weight:700;
      cursor:pointer;
    }

    .btn[disabled]{opacity:.6}

    .note{font-size:12px;color:var(--muted)}

    .done{
      display:none;
      text-align:center;
      padding:18px;
      border-radius:12px;
      border:1px solid rgba(15,157,88,.25);
      background:rgba(15,157,88,.06);
    }

    .done h3{margin:0;color:var(--success)}
  </style>
</head>

<body>

<div class="wrap">
  <div class="card">

    <h1>顧客滿意度問卷</h1>
    <p class="lead">請花 1 分鐘回答幾個問題，您的回饋對我們很重要。</p>

    <div id="status">正在載入...</div>

    <!-- 已填寫 -->
    <div id="doneArea" class="done">
      <h3>您已填寫過此問卷，感謝您的回饋！</h3>
    </div>

    <!-- 問卷 -->
    <div id="surveyArea" style="display:none;">
      <form id="surveyForm">

        <input type="hidden" name="UID" id="UID">

        <h3>一、基本資料</h3>

        <div class="field">
          <label class="question">1. 您的性別</label>
          <select name="gender" required>
            <option value="">請選擇</option>
            <option>男</option>
            <option>女</option>
            <option>不便透露</option>
          </select>
        </div>

        <div class="field">
          <label class="question">2. 您的年齡</label>
          <select name="ageRange" required>
            <option value="">請選擇</option>
            <option>20歲以下</option>
            <option>21–30歲</option>
            <option>31–40歲</option>
            <option>41–50歲</option>
            <option>51歲以上</option>
          </select>
        </div>

        <div class="field">
          <label class="question">3. 本次消費的門市</label>
          <select name="store" required>
            <option value="">請選擇</option>
            <option>西區</option><option>大里</option><option>斗六</option>
            <option>大埔</option><option>漢口</option><option>太平</option>
            <option>松竹</option><option>東山</option><option>員林</option>
            <option>美村南</option><option>烏日</option><option>北平</option>
            <option>黎明</option><option>精誠</option><option>精武東</option>
            <option>大雅</option>
          </select>
        </div>

        <div class="field">
          <label class="question">4. 本次消費日期</label>
          <input type="date" name="purchaseDate" required>
        </div>

        <h3>二、門市服務體驗</h3>

        <div class="field">
          <label class="question">對於門市消費體驗，您的整體滿意度是？</label>
          <div class="options">
            <label><input type="radio" name="overallScore" value="1" required> 1</label>
            <label><input type="radio" name="overallScore" value="2"> 2</label>
            <label><input type="radio" name="overallScore" value="3"> 3</label>
            <label><input type="radio" name="overallScore" value="4"> 4</label>
            <label><input type="radio" name="overallScore" value="5"> 5</label>
          </div>
        </div>

        <div class="field" id="lowScoreArea" style="display:none;">
          <label class="question">請問我們在哪些方面可以再加強？（可複選）</label>
          <label><input type="checkbox" name="improve[]" value="接待互動">接待互動（希望互動更積極或更多關注）</label>
          <label><input type="checkbox" name="improve[]" value="商品介紹">商品介紹（希望資訊能更完整或清楚）</label>
          <label><input type="checkbox" name="improve[]" value="體驗流程">體驗流程（希望有更多試用或展示機會）</label>
          <label><input type="checkbox" name="improve[]" value="服務態度">服務態度（希望能更有耐心或親切）</label>
          <label><input type="checkbox" name="improve[]" value="結帳與說明">結帳與說明（希望保固與注意事項更清楚）</label>
          <label><input type="checkbox" name="improve[]" value="商品選擇">商品選擇（希望款式／規格有更多選擇）</label>
          <label><input type="checkbox" name="improve[]" value="商品適配度">商品適配度（希望更容易找到適合的商品）</label>
          <label><input type="checkbox" name="improve[]" value="價格與價值感受">價格與價值感受（期待更符合預期）</label>
          <input type="text" name="improveOther" placeholder="其他">
        </div>

        <div class="field" id="highScoreArea" style="display:none;">
          <label class="question">在消費過程中，讓您感覺不錯的地方？</label>
          <label><input type="checkbox" name="good[]" value="人員親切"> 人員親切有禮</label>
          <label><input type="checkbox" name="good[]" value="商品專業"> 商品資訊清楚，專業說明充足</label>
          <label><input type="checkbox" name="good[]" value="商品符合需求"> 提供試用/體驗商品的機會</label>
           <label><input type="checkbox" name="good[]" value="結帳與說明"> 結帳與保固說明清楚 </label>
           <label><input type="checkbox" name="good[]" value="沒有特別感覺"> 沒有特別感覺</label>
           <label><input type="checkbox" name="good[]" value="商品適配度"> 商品符合需求</label>
           <label><input type="checkbox" name="good[]" value="價格與價值感受"> 商品價格與價值符合</label>
           <label><input type="checkbox" name="good[]" value="商品選擇"> 商品選擇多、好比較</label>
          <input type="text" name="goodOther" placeholder="其他">
        </div>

        <div class="field">
          <label class="question">整體推薦度（1–5）</label>
          <div class="options">
            <label><input type="radio" name="recommend" value="1" required> 1</label>
            <label><input type="radio" name="recommend" value="2"> 2</label>
            <label><input type="radio" name="recommend" value="3"> 3</label>
            <label><input type="radio" name="recommend" value="4"> 4</label>
            <label><input type="radio" name="recommend" value="5"> 5</label>
          </div>
        </div>

        <h3>三、開放式回饋</h3>

        <div class="field">
          <label class="question">印象深刻的地方</label>
          <textarea name="open1" rows="3"></textarea>
        </div>

        <div class="field">
          <label class="question">希望改進的地方</label>
          <textarea name="open2" rows="3"></textarea>
        </div>

        <div class="note">您的回覆僅作為內部改善使用</div>

        <button id="submitBtn" type="submit" class="btn">送出問卷</button>

      </form>
    </div>
  </div>
</div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbzCphcqbEMUOcioq-owF9Q5jbtHvYRCAvxOm3Qb3lZLJd8ULYcrrFWhwA_CmIibtHKm/exec";

document.addEventListener("DOMContentLoaded", async () => {
  try{
    await liff.init({ liffId: "2001230327-l7YbvL9o" });
    const profile = await liff.getProfile();
    document.getElementById("UID").value = profile.userId;

    const res = await fetch(`${GAS_URL}?uid=${profile.userId}&check=1`);
    const data = await res.json();

    document.getElementById("status").style.display = "none";

    if(data.filled){
      document.getElementById("doneArea").style.display = "block";
    }else{
      document.getElementById("surveyArea").style.display = "block";
    }

    document.querySelectorAll('input[name="overallScore"]').forEach(r=>{
      r.addEventListener("change",()=>{
        const v=Number(r.value);
        lowScoreArea.style.display = v<=3 ? "block":"none";
        highScoreArea.style.display = v>=4 ? "block":"none";
      });
    });

  }catch(e){
    document.getElementById("status").textContent="載入失敗，請稍後再試";
    console.error(e);
  }
});

document.getElementById("surveyForm").addEventListener("submit", async e => {
  e.preventDefault();

  const submitBtn = document.getElementById("submitBtn");
  const surveyArea = document.getElementById("surveyArea");
  const doneArea = document.getElementById("doneArea");

  submitBtn.disabled = true;
  submitBtn.textContent = "送出中…";

  try {
    const res = await fetch(GAS_URL, {
      method: "POST",
      body: new FormData(e.target)
    });

    const result = await res.json();

    if (result.status === "success") {
      surveyArea.style.display = "none";
      doneArea.style.display = "block";
    } else if (result.status === "duplicate") {
      alert("您已填寫過此問卷");
      submitBtn.disabled = false;
      submitBtn.textContent = "送出問卷";
    } else {
      throw new Error("unknown response");
    }

  } catch (err) {
    console.error(err);
    alert("送出失敗，請稍後再試");
    submitBtn.disabled = false;
    submitBtn.textContent = "送出問卷";
  }
});
</script>

</body>
</html>


</body>
</html>
